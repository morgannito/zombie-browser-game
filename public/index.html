<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Jeu de Zombie Multijoueur</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üßü</text></svg>">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="addictionStyles.css">
</head>
<body>
    <div id="ui">
        <div id="nickname-screen" style="display: flex;">
            <div class="nickname-container">
                <h1>üßü ZOMBIE SURVIVAL üßü</h1>
                <p class="nickname-subtitle">Entrez votre pseudo pour commencer</p>
                <input type="text" id="nickname-input" placeholder="Votre pseudo..." maxlength="15" autofocus>
                <button id="start-game-btn">Commencer la partie</button>
                <div class="game-info">
                    <p>üéÆ Mode infini avec vagues progressives</p>
                    <p>‚¨ÜÔ∏è Montez en niveau et d√©bloquez des upgrades</p>
                    <p>üèÜ Survivez le plus longtemps possible !</p>
                </div>
                <!-- Widgets sur l'√©cran d'accueil -->
                <div id="home-widgets" class="home-widgets"></div>
            </div>
        </div>

        <!-- Menu de navigation -->
        <div id="game-menu" style="display: none;">
            <div class="menu-buttons">
                <button id="menu-btn-achievements" class="menu-btn" title="Achievements">üèÜ</button>
                <button id="menu-btn-challenges" class="menu-btn" title="D√©fis">üéØ</button>
                <button id="menu-btn-leaderboard" class="menu-btn" title="Leaderboard">üìä</button>
                <button id="menu-btn-unlocks" class="menu-btn" title="Armes">üîì</button>
                <button id="menu-btn-synergies" class="menu-btn" title="Synergies">‚ö°</button>
                <button id="menu-btn-lifetime-stats" class="menu-btn" title="Statistiques">üìà</button>
                <button id="menu-btn-gem-shop" class="menu-btn" title="Gem Shop">üíé</button>
            </div>
        </div>

        <div id="stats">
            <div id="player-name-display"></div>
            <div id="health-container">
                <span>Vie:</span>
                <div id="health-bar">
                    <div id="health-fill"></div>
                </div>
                <span id="health-text">100</span>
            </div>
            <div id="xp-container">
                <span>Niveau <span id="level-text">1</span>:</span>
                <div id="xp-bar">
                    <div id="xp-fill"></div>
                </div>
                <span id="xp-text">0/50</span>
            </div>
            <div id="score">Score: <span id="score-value">0</span></div>
            <div id="wave">Vague: <span id="wave-value">1</span></div>
            <div id="weapon">Or: <span id="gold-value">0</span> üí∞</div>
            <div id="gems-display">Gems: <span id="gems-value" class="gem-balance">0</span> üíé</div>
            <div id="players-online">Joueurs en ligne: <span id="players-count">1</span></div>
            <div id="zombies-alive">Zombies: <span id="zombies-count">0</span></div>
            <div id="latency-display">Latence: <span id="latency-indicator" class="latency-indicator">--ms</span></div>
        </div>

        <div id="spawn-protection" style="display: none;">
            <div class="protection-message">
                üõ°Ô∏è PROTECTION ACTIVE : <span id="protection-timer">3</span>s
            </div>
        </div>

        <!-- Boss Health Bar -->
        <div id="boss-health-container" style="display: none;">
            <div class="boss-health-wrapper">
                <div class="boss-name-container">
                    <span id="boss-name">BOSS</span>
                    <span id="boss-phase" class="boss-phase">Phase 1</span>
                </div>
                <div class="boss-health-bar-outer">
                    <div id="boss-health-bar" class="boss-health-bar-fill"></div>
                    <span id="boss-health-text" class="boss-health-text">100%</span>
                </div>
            </div>
        </div>

        <!-- Kill Feed -->
        <div id="kill-feed" class="kill-feed"></div>

        <!-- Combo Display -->
        <div id="combo-display" style="display: none;">
            <div class="combo-wrapper">
                <span class="combo-text">COMBO</span>
                <span id="combo-count" class="combo-count">0</span>
                <span class="combo-multiplier">x<span id="combo-multiplier">1.0</span></span>
            </div>
        </div>

        <!-- Wave Progress Bar -->
        <div id="wave-progress-container">
            <div class="wave-progress-header">
                <span class="wave-progress-label">Vague <span id="wave-progress-number">1</span></span>
                <span class="wave-progress-count"><span id="wave-kills">0</span>/<span id="wave-target">10</span></span>
            </div>
            <div class="wave-progress-bar-outer">
                <div id="wave-progress-bar" class="wave-progress-bar-fill"></div>
            </div>
        </div>

        <div id="wave-announcement" style="display: none;">
            <h1>VAGUE <span id="wave-number">2</span></h1>
            <p>Pr√©parez-vous!</p>
        </div>

        <div id="game-over" style="display: none;">
            <div class="game-over-header">
                <h1>üíÄ GAME OVER üíÄ</h1>
                <p class="game-over-subtitle">Vous √™tes mort...</p>
            </div>
            <div class="game-over-stats">
                <div class="stat-row main-stat">
                    <span class="stat-label">üèÜ Score Final</span>
                    <span class="stat-value" id="final-score">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">üìä Vague atteinte</span>
                    <span class="stat-value" id="final-wave">1</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">‚¨ÜÔ∏è Niveau atteint</span>
                    <span class="stat-value" id="final-level">1</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">üí∞ Or gagn√©</span>
                    <span class="stat-value" id="final-gold">0</span>
                </div>
            </div>
            <button id="respawn-btn">üîÑ Recommencer</button>
        </div>

        <div id="shop" style="display: none;">
            <div class="shop-header">
                <h1>üõí SHOP</h1>
                <p>Or disponible: <span id="shop-gold">0</span> üí∞</p>
                <button id="shop-close-btn">Continuer ‚Üí</button>
            </div>

            <div class="shop-content">
                <div class="shop-section">
                    <h2>Upgrades Permanents</h2>
                    <div id="permanent-upgrades"></div>
                </div>

                <div class="shop-section">
                    <h2>Items Temporaires</h2>
                    <div id="temporary-items"></div>
                </div>
            </div>
        </div>

        <div id="level-up-screen" style="display: none;">
            <div class="level-up-container">
                <h1 class="level-up-title">‚¨ÜÔ∏è LEVEL UP ! ‚¨ÜÔ∏è</h1>
                <p class="level-up-subtitle">Choisissez une am√©lioration</p>
                <div id="upgrade-choices" class="upgrade-choices"></div>
            </div>
        </div>

        <div id="stats-panel" style="display: none;">
            <div class="stats-panel-header">
                <h2>üìä STATISTIQUES</h2>
                <p class="stats-hint">Appuyez sur TAB pour fermer</p>
            </div>
            <div class="stats-panel-content">
                <div class="stats-section">
                    <h3>üéØ Stats de Base</h3>
                    <div id="base-stats"></div>
                </div>
                <div class="stats-section">
                    <h3>‚¨ÜÔ∏è Am√©liorations Actives</h3>
                    <div id="active-upgrades"></div>
                </div>
                <div class="stats-section">
                    <h3>üõí Upgrades Permanents (Shop)</h3>
                    <div id="permanent-shop-upgrades"></div>
                </div>
            </div>
        </div>

        <div id="instructions" class="collapsed">
            <div id="instructions-header">
                <h3>üéÆ Contr√¥les</h3>
                <button id="instructions-toggle" aria-label="Toggle instructions">‚ñº</button>
            </div>
            <div id="instructions-content">
                <div class="control-item">
                    <div class="control-keys">
                        <span class="key">W</span>
                        <span class="key">A</span>
                        <span class="key">S</span>
                        <span class="key">D</span>
                        <span class="control-separator">ou</span>
                        <span class="key">‚Üë</span>
                        <span class="key">‚Üê</span>
                        <span class="key">‚Üì</span>
                        <span class="key">‚Üí</span>
                    </div>
                    <div class="control-description">üèÉ D√©placement</div>
                </div>
                <div class="control-item">
                    <div class="control-keys">
                        <span class="key-icon">üñ±Ô∏è</span>
                    </div>
                    <div class="control-description">üéØ Viser</div>
                </div>
                <div class="control-item">
                    <div class="control-keys">
                        <span class="key">Clic</span>
                    </div>
                    <div class="control-description">üí• Tirer</div>
                </div>
                <div class="control-item">
                    <div class="control-keys">
                        <span class="key">TAB</span>
                    </div>
                    <div class="control-description">üìä Statistiques</div>
                </div>
            </div>
        </div>

        <canvas id="minimap"></canvas>
        <button id="minimap-toggle" aria-label="Toggle minimap" style="display: none;">
            üìç
        </button>
        <button id="camera-recenter-btn" aria-label="Recenter camera" title="Recentrer la cam√©ra (C)" style="display: none;">
            üéØ
        </button>

        <!-- Toast Notifications Container -->
        <div id="toast-container"></div>

        <!-- Enemy Indicators Container (for off-screen elite/boss) -->
        <div id="enemy-indicators"></div>

        <!-- Settings Menu -->
        <div id="settings-menu" style="display: none;">
            <div class="settings-overlay"></div>
            <div class="settings-modal">
                <div class="settings-header">
                    <h2>‚öôÔ∏è PARAM√àTRES</h2>
                    <button id="settings-close-btn" class="settings-close">‚úï</button>
                </div>

                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="audio">üîä Audio</button>
                    <button class="settings-tab" data-tab="graphics">üé® Graphismes</button>
                    <button class="settings-tab" data-tab="controls">üéÆ Contr√¥les</button>
                </div>

                <div class="settings-content">
                    <!-- Audio Tab -->
                    <div class="settings-tab-content active" id="settings-audio">
                        <div class="settings-section">
                            <div class="setting-item">
                                <label for="volume-master">Volume Principal</label>
                                <div class="slider-container">
                                    <input type="range" id="volume-master" min="0" max="100" value="70" class="slider">
                                    <span class="slider-value">70%</span>
                                </div>
                            </div>
                            <div class="setting-item">
                                <label for="volume-music">Musique</label>
                                <div class="slider-container">
                                    <input type="range" id="volume-music" min="0" max="100" value="50" class="slider">
                                    <span class="slider-value">50%</span>
                                </div>
                            </div>
                            <div class="setting-item">
                                <label for="volume-sfx">Effets Sonores</label>
                                <div class="slider-container">
                                    <input type="range" id="volume-sfx" min="0" max="100" value="80" class="slider">
                                    <span class="slider-value">80%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Graphics Tab -->
                    <div class="settings-tab-content" id="settings-graphics">
                        <div class="settings-section">
                            <div class="setting-item">
                                <label for="graphics-quality">Qualit√© Graphique</label>
                                <select id="graphics-quality" class="settings-select">
                                    <option value="low">Basse</option>
                                    <option value="medium" selected>Moyenne</option>
                                    <option value="high">Haute</option>
                                    <option value="ultra">Ultra</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="particles-toggle">Particules</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="particles-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label for="screen-shake-toggle">Screen Shake</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="screen-shake-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label for="blood-toggle">Effets de Sang</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="blood-toggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Controls Tab -->
                    <div class="settings-tab-content" id="settings-controls">
                        <div class="settings-section">
                            <div class="controls-info">
                                <h3>üéÆ Contr√¥les Actuels</h3>
                                <div class="control-mapping">
                                    <div class="control-row">
                                        <span class="control-action">D√©placement</span>
                                        <span class="control-keys">WASD / Fl√®ches</span>
                                    </div>
                                    <div class="control-row">
                                        <span class="control-action">Tirer</span>
                                        <span class="control-keys">Clic Gauche</span>
                                    </div>
                                    <div class="control-row">
                                        <span class="control-action">Viser</span>
                                        <span class="control-keys">Souris</span>
                                    </div>
                                    <div class="control-row">
                                        <span class="control-action">Stats</span>
                                        <span class="control-keys">TAB</span>
                                    </div>
                                    <div class="control-row">
                                        <span class="control-action">Recentrer Cam√©ra</span>
                                        <span class="control-keys">C</span>
                                    </div>
                                    <div class="control-row">
                                        <span class="control-action">Pause</span>
                                        <span class="control-keys">ESC</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-footer">
                    <button id="settings-reset-btn" class="btn-secondary">R√©initialiser</button>
                    <button id="settings-apply-btn" class="btn-primary">Appliquer</button>
                </div>
            </div>
        </div>

        <!-- Settings Button (top-right corner) -->
        <button id="settings-btn" class="settings-toggle-btn" title="Param√®tres (ESC)" style="display: none;">
            ‚öôÔ∏è
        </button>

        <!-- Pause Menu -->
        <div id="pause-menu" style="display: none;">
            <div class="pause-overlay"></div>
            <div class="pause-modal">
                <div class="pause-header">
                    <h1 class="pause-title">‚è∏Ô∏è PAUSE</h1>
                </div>

                <div class="pause-stats">
                    <div class="pause-stat-item">
                        <div class="pause-stat-label">Vague</div>
                        <div class="pause-stat-value" id="pause-wave">1</div>
                    </div>
                    <div class="pause-stat-item">
                        <div class="pause-stat-label">Niveau</div>
                        <div class="pause-stat-value" id="pause-level">1</div>
                    </div>
                    <div class="pause-stat-item">
                        <div class="pause-stat-label">Score</div>
                        <div class="pause-stat-value" id="pause-score">0</div>
                    </div>
                    <div class="pause-stat-item">
                        <div class="pause-stat-label">Kills</div>
                        <div class="pause-stat-value" id="pause-kills">0</div>
                    </div>
                    <div class="pause-stat-item">
                        <div class="pause-stat-label">Temps</div>
                        <div class="pause-stat-value" id="pause-time">0:00</div>
                    </div>
                    <div class="pause-stat-item">
                        <div class="pause-stat-label">Or</div>
                        <div class="pause-stat-value" id="pause-gold">0</div>
                    </div>
                </div>

                <div class="pause-buttons">
                    <button id="pause-resume-btn" class="pause-btn pause-btn-resume">
                        ‚ñ∂Ô∏è Reprendre
                    </button>
                    <button id="pause-settings-btn" class="pause-btn pause-btn-settings">
                        ‚öôÔ∏è Param√®tres
                    </button>
                    <button id="pause-quit-btn" class="pause-btn pause-btn-quit">
                        üö™ Quitter
                    </button>
                </div>

                <div class="pause-hint">
                    Appuyez sur <span class="key-hint">ESC</span> pour reprendre
                </div>
            </div>
        </div>

        <!-- Weapon Wheel -->
        <div id="weapon-wheel" style="display: none;">
            <div class="weapon-wheel-overlay"></div>
            <div class="weapon-wheel-container">
                <div class="weapon-wheel-center">
                    <div class="weapon-wheel-title">Arme</div>
                    <div class="weapon-wheel-current" id="weapon-wheel-current">Pistolet</div>
                </div>
                <div class="weapon-wheel-slots" id="weapon-wheel-slots">
                    <!-- Weapon slots will be dynamically generated -->
                </div>
            </div>
            <div class="weapon-wheel-hint">
                Survolez et cliquez pour s√©lectionner ‚Ä¢ Touche <span class="key-hint">Q</span> pour fermer
            </div>
        </div>

        <!-- Mobile Controls -->
        <div id="mobile-controls" style="display: none;">
            <!-- Virtual Joystick -->
            <div id="joystick-container">
                <div id="joystick-base">
                    <div id="joystick-stick"></div>
                </div>
            </div>

            <!-- Auto-shoot button -->
            <div id="auto-shoot-container">
                <button id="auto-shoot-btn">
                    <span class="shoot-icon">üéØ</span>
                    <span class="shoot-text">TIR AUTO</span>
                </button>
            </div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script src="/socket.io/socket.io.js"></script>
    <!-- Memory Leak Prevention (MUST be loaded first) -->
    <script src="EventListenerManager.js"></script>
    <script src="TimerManager.js"></script>
    <!-- Performance & Math Utilities -->
    <script src="lib/MathUtils.js"></script>
    <script src="lib/PerformanceUtils.js"></script>
    <!-- Asset Management -->
    <script src="assetManager.js"></script>
    <script src="professionalAssetGenerator.js"></script>
    <script src="demoAssetGenerator.js"></script>
    <script src="assetIntegration.js"></script>
    <!-- New Enhanced Systems -->
    <script src="visualEffects.js"></script>
    <script src="screenEffects.js"></script>
    <script src="weaponAudioSystem.js"></script>
    <script src="audioSystem.js"></script>
    <script src="skinSystem.js"></script>
    <script src="enhancedUI.js"></script>
    <script src="performanceSettings.js"></script>
    <script src="gameIntegration.js"></script>
    <!-- Addiction Systems (Phase 1-3) -->
    <script src="achievementSystem.js"></script>
    <script src="dailyChallenges.js"></script>
    <!-- leaderboardSystem.js removed - LeaderboardSystem is now in game.js -->
    <script src="unlockSystem.js"></script>
    <script src="synergySystem.js"></script>
    <script src="missionSystem.js"></script>
    <script src="lifetimeStats.js"></script>
    <script src="gemSystem.js"></script>
    <script src="retentionHooks.js"></script>
    <script src="eventSystem.js"></script>
    <!-- Integration Layer -->
    <script src="addictionIntegration.js"></script>
    <!-- JWT Authentication -->
    <script src="auth.js"></script>

    <!-- Game Modules (refactored from game.js) -->
    <!-- Core modules -->
    <script src="modules/core/Constants.js"></script>
    <script src="modules/core/SessionManager.js"></script>

    <!-- Managers -->
    <script src="modules/managers/GameStateManager.js"></script>
    <script src="modules/managers/InputManager.js"></script>
    <script src="modules/managers/AudioManager.js"></script>
    <script src="modules/managers/MobileControlsManager.js"></script>
    <script src="modules/managers/CameraManager.js"></script>
    <script src="modules/managers/UIManager.js"></script>
    <script src="modules/managers/NicknameManager.js"></script>

    <!-- Systems -->
    <script src="modules/systems/ComboSystem.js"></script>
    <script src="modules/systems/ToastManager.js"></script>
    <script src="modules/systems/LeaderboardSystem.js"></script>
    <script src="modules/systems/NetworkManager.js"></script>
    <script src="modules/systems/AccountProgressionManager.js"></script>

    <!-- Game Logic -->
    <script src="modules/game/PlayerController.js"></script>
    <script src="modules/game/Renderer.js"></script>

    <!-- Game Engine (must be after all dependencies) -->
    <script src="modules/core/GameEngine.js"></script>

    <!-- Performance Optimizations -->
    <script src="modules/rendering/FrustumCuller.js"></script>

    <!-- Utilities -->
    <script src="modules/utils/initHelpers.js"></script>

    <!-- Tutorial System -->
    <script src="tutorialSystem.js"></script>

    <!-- Settings Menu (must be loaded before game.js) -->
    <script src="settingsMenu.js"></script>

    <!-- Pause Menu -->
    <script src="pauseMenu.js"></script>

    <!-- Weapon Wheel -->
    <script src="weaponWheel.js"></script>

    <!-- Enemy Markers -->
    <script src="enemyMarkers.js"></script>

    <!-- Main Game Initialization -->
    <script src="game.js"></script>

    <!-- Game Patch (must be loaded after game.js) -->
    <script src="gamePatch.js"></script>
</body>
</html>
